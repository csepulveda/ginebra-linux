#!/bin/sh
# bali - Ginebra Linux Package Manager

VERSION="0.2"
DEFAULT_IP="192.168.100.149"
DEFAULT_PORT="8080"

cat << 'BANNER'
,-----.          ,--.,--.
|  |) /_  ,--,--.|  |`--'
|  .-.  \' ,-.  ||  |,--.
|  '--' /\ '-'  ||  ||  |
`------'  `--`--'`--'`--'
BANNER
echo " Package Manager v$VERSION"
echo ""


printf "Server IP [$DEFAULT_IP]: "
read IP
IP=${IP:-$DEFAULT_IP}

printf "Server Port [$DEFAULT_PORT]: "
read PORT
PORT=${PORT:-$DEFAULT_PORT}

URL="http://${IP}:${PORT}"

echo ""
echo "Fetching package list..."
echo ""

PACKAGES=$(wget -q -O - "$URL/list.txt")

if [ -z "$PACKAGES" ]; then
    echo "Error: Could not fetch package list"
    exit 1
fi

echo "Available packages:"
echo "-------------------"
echo "$PACKAGES" | while read pkg; do
    echo "  - $pkg"
done
echo ""
echo "  (a = install all, q = quit)"
echo ""

printf "Packages to install: "
read SELECTION

[ "$SELECTION" = "q" ] && exit 0
[ "$SELECTION" = "a" ] && SELECTION="$PACKAGES"

echo ""
for pkg in $SELECTION; do
    echo "[+] Installing $pkg..."

    # Try package format first (.pkg.tar.gz)
    wget -q -O "/tmp/${pkg}.pkg.tar.gz" "${URL}/${pkg}.pkg.tar.gz" 2>/dev/null

    if [ -f "/tmp/${pkg}.pkg.tar.gz" ] && [ -s "/tmp/${pkg}.pkg.tar.gz" ]; then
        # Extract package to /
        tar xzf "/tmp/${pkg}.pkg.tar.gz" -C / 2>/dev/null
        if [ $? -eq 0 ]; then
            echo "    OK (package)"
            rm -f "/tmp/${pkg}.pkg.tar.gz"
            continue
        fi
        rm -f "/tmp/${pkg}.pkg.tar.gz"
    fi

    # Fallback to plain binary
    wget -q -O "/usr/bin/$pkg" "${URL}/${pkg}" 2>/dev/null
    if [ $? -eq 0 ] && [ -s "/usr/bin/$pkg" ]; then
        chmod +x "/usr/bin/$pkg"
        echo "    OK (binary)"
    else
        echo "    FAILED"
        rm -f "/usr/bin/$pkg"
    fi
done

echo ""
echo "Done!"
